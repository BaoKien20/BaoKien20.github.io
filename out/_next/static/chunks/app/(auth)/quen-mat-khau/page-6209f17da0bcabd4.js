(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{639:function(e,t,n){Promise.resolve().then(n.t.bind(n,5250,23)),Promise.resolve().then(n.bind(n,8455))},8455:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(7437),a=n(2265),s=n(2670),l=n(248),o=n(1270),i=n(3161),c=n(1021),u=n(1065),d=n(4333),m=e=>{var t;let{setForm:n,setOtpRes:m}=e,[h,p]=a.useState(!1);(0,c.useRouter)();let g=l.Ry({email:l.Z_().trim().min(1,{message:"Email kh\xf4ng được để trống"}).email({message:"Email kh\xf4ng hợp lệ"})}),{register:x,handleSubmit:f,formState:{errors:w},setError:b}=(0,s.cI)({resolver:(0,o.F)(g)}),v=async e=>{p(!0);let t=await (0,d.dA)(e.email);200===t.status?(m({email:e.email,expires:t.data.expires}),n("confirm-otp")):b("email",{message:t.data.message}),console.log("SendOTP res",t),p(!1)};return console.log("error",w),(0,r.jsxs)("form",{onSubmit:f(e=>v(e)),className:"  text-sm  text-default p-6 w-[400px]",children:[(0,r.jsx)("div",{className:"",children:(0,r.jsx)("input",{...x("email"),className:(0,u.cn)(" bg-dark4  max-h-[36px] outline-none w-full px-3 py-2 ",{"border border-red-500":w.email}),name:"email",maxLength:40,type:"text",placeholder:"Email"})}),(0,r.jsx)("div",{className:"text-red-500 text-xs min-h-6 h-fit flex gap-1 items-center",children:w.email&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Pz,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:null==w?void 0:null===(t=w.email)||void 0===t?void 0:t.message})]})}),h?(0,r.jsx)("div",{className:"loadingText cursor-wait text-center bg-mainColor/90  w-full p-2 text-sm text-des uppercase font-bold tracking-wider"}):(0,r.jsx)("button",{type:"submit",disabled:h,className:"bg-mainColor/90   w-full p-2 text-sm text-des uppercase font-bold tracking-wider cursor-pointer hover:bg-mainColor hover:text-black ",children:"Gửi m\xe3 x\xe1c nhận"})]})},h=n(8009),p=n(3503),g=e=>{let{setOtpRes:t,otpRes:n}=e,[s,l]=a.useState(new Date(n.expires).getTime()-new Date().getTime()),[o,i]=a.useState(!1),c=async()=>{i(!0);let e=await (0,d.dA)(n.email);200===e.status?(t({email:n.email,expires:e.data.expires}),l(new Date(e.data.expires).getTime()-new Date().getTime()),h.default.success("Gửi m\xe3 OTP th\xe0nh c\xf4ng")):h.default.error("Gửi m\xe3 OTP thất bại, vui l\xf2ng thử lại sau"),console.log("SendOTP res",e),i(!1)};return(0,a.useEffect)(()=>{let e=new Date(n.expires).getTime(),t=setInterval(()=>{let n=new Date().getTime();console.log("currentTime",n,"expiresTime",e),n<e?(console.log("resentTime",s),l(e-n)):(l(0),clearInterval(t))},1e3);return()=>{clearInterval(t)}},[n.expires]),(0,r.jsxs)("div",{className:"text-xs text-default/70 mt-4",children:["Kh\xf4ng nhận được m\xe3?"," ",(0,r.jsx)("button",{onClick:c,disabled:s>0||o,className:(0,u.cn)("font-medium ",s>0?"text-default/70":"text-mainColor/90 hover:text-mainColor"),children:o?"Đang gửi...":s>0?"Gửi lại sau ".concat((0,p.mr)(s)):"Gửi lại"})]})},x=e=>{let{setForm:t,otpRes:n,setOtpRes:s}=e,l=(0,a.useRef)([]),[o,i]=a.useState(!1),[c,u]=a.useState(""),m=e=>{console.log("focusNextInput",e),e<5&&l.current[e+1].focus(),u(l.current.map(e=>e.value).join(""))},p=async e=>{e.preventDefault(),i(!0);let r=l.current.map(e=>e.value).join(""),a=await (0,d.k9)(n.email,r);200===a.status?(h.default.success("X\xe1c thực th\xe0nh c\xf4ng, vui l\xf2ng đặt lại mật khẩu"),s({...n,token:a.data.token}),t("reset-password")):h.default.error("M\xe3 OTP kh\xf4ng ch\xednh x\xe1c"),i(!1)};return(0,a.useEffect)(()=>{let e=e=>{if(e.preventDefault(),e.clipboardData){let t=e.clipboardData.getData("text");6===t.length&&t.match(/^[0-9]*$/)&&(l.current.forEach((e,n)=>{e.value=t[n]}),u(t))}};return window.addEventListener("paste",e),()=>{window.removeEventListener("paste",e)}},[]),(0,r.jsxs)("div",{className:" mx-auto text-center  p-4  ",children:[(0,r.jsxs)("p",{className:"text-sm text-title mb-3 ",children:["Nhập 6 số vừa được gửi đến email ",(0,r.jsx)("b",{children:n.email}),(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"text-xs",children:" Vui l\xf2ng kiểm tra cả b\xean trong thư r\xe1c"})]}),(0,r.jsxs)("form",{onSubmit:p,id:"otp-form",children:[(0,r.jsx)("div",{className:"flex items-center justify-center gap-3",children:Array.from({length:6}).map((e,t)=>(0,r.jsx)("input",{type:"text",name:"otp"+t,onKeyDown:e=>{0===l.current[t].value.length&&"Backspace"===e.key?m(0===t?t-1:t-2):e.key.match(/^[0-9]$/)||"Backspace"===e.key||"Delete"===e.key||e.preventDefault()},ref:e=>l.current[t]=e,onChange:e=>{e.target.value.length>0&&m(t)},className:"size-12 text-center text-xl font-extrabold text-default bg-dark4   appearance-none rounded p-4 outline-none border border-transparent focus:border-mainColor ",pattern:"\\d*",maxLength:1,onFocus:e=>{e.target.select()}},t))}),(0,r.jsx)("div",{className:"max-w-[260px] mx-auto mt-4",children:o?(0,r.jsx)("div",{className:"loadingText cursor-wait text-center bg-mainColor/90  w-full p-2 text-sm text-des uppercase font-bold tracking-wider"}):(0,r.jsx)("button",{type:"submit",disabled:c.length<6,className:"w-full inline-flex disabled:bg-mainColor/50 justify-center whitespace-nowrap rounded-lg bg-mainColor/90 px-3.5 py-2.5 text-sm font-medium text-des shadow-sm shadow-indigo-950/10 hover:bg-mainColor focus:outline-none focus:ring focus:ring-indigo-300 focus-visible:outline-none focus-visible:ring focus-visible:ring-indigo-300 transition-colors duration-150",children:"X\xe1c thực"})})]}),(0,r.jsx)(g,{setOtpRes:s,otpRes:n})]})},f=e=>{var t,n;let{otpRes:m}=e,[p,g]=a.useState(!1),x=(0,c.useRouter)(),f=l.Ry({password:l.Z_().trim().min(1,{message:"Mật khẩu kh\xf4ng được để trống"}).min(6,{message:"Mật khẩu phải c\xf3 \xedt nhất 6 k\xfd tự"}).max(25,{message:"Mật khẩu qu\xe1 d\xe0i"}).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,}$/,{message:"Mật khẩu phải c\xf3 \xedt nhất 1 chữ thường, 1 chữ hoa v\xe0 1 số bất kỳ"}),confirmPassword:l.Z_().trim().min(1,{message:"X\xe1c nhận mật khẩu kh\xf4ng được để trống"})}).refine(e=>e.password===e.confirmPassword,{message:"Mật khẩu kh\xf4ng tr\xf9ng khớp",path:["confirmPassword"]}),{register:w,handleSubmit:b,formState:{errors:v},setError:k,reset:y}=(0,s.cI)({resolver:(0,o.F)(f)}),j=async e=>{if(!m.token){h.default.error("X\xe1c thực kh\xf4ng hợp lệ, vui l\xf2ng thử lại");return}g(!0);let t=await (0,d.c0)(m.email,e.password,m.token);200===t.status?(h.default.success("Đặt lại mật khẩu th\xe0nh c\xf4ng"),x.push("/dang-nhap")):h.default.error("Đ\xe3 xảy ra lỗi, vui l\xf2ng x\xe1c thực lại OTP"),console.log("resetPassword res",t),console.log("otpRes",m),console.log("data",e),g(!1)};return console.log("error",v),(0,r.jsxs)("form",{onSubmit:b(e=>j(e)),className:"  text-sm  text-default p-6 w-[400px]",children:[(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsx)("input",{...w("password"),className:(0,u.cn)(" bg-dark4 max-h-[36px]  outline-none w-full  px-3 py-2",{"border border-red-500":v.password}),name:"password",maxLength:25,type:"password",placeholder:"Mật khẩu"})}),(0,r.jsx)("div",{className:"",children:(0,r.jsx)("input",{...w("confirmPassword"),className:(0,u.cn)(" bg-dark4 max-h-[36px]  outline-none w-full  px-3 py-2",{"border border-red-500":v.confirmPassword}),name:"confirmPassword",maxLength:25,type:"password",placeholder:"X\xe1c nhận mật khẩu"})}),(0,r.jsx)("div",{className:"text-red-500 text-xs min-h-6 h-fit flex gap-1 items-center",children:Object.keys(v).length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Pz,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:(null==v?void 0:null===(t=v.password)||void 0===t?void 0:t.message)||(null==v?void 0:null===(n=v.confirmPassword)||void 0===n?void 0:n.message)||""})]})}),p?(0,r.jsx)("div",{className:"loadingText cursor-wait text-center bg-mainColor/90  w-full p-2 text-sm text-des uppercase font-bold tracking-wider"}):(0,r.jsx)("button",{type:"submit",disabled:p,className:"bg-mainColor/90  w-full p-2 text-sm text-des uppercase font-bold tracking-wider hover:text-black hover:bg-mainColor",children:"Đặt lại mật khẩu"})]})},w=()=>{let[e,t]=(0,a.useState)("send-email"),[n,s]=(0,a.useState)({email:"",expires:""});switch(e){case"send-email":default:return(0,r.jsx)(m,{setOtpRes:s,setForm:t});case"confirm-otp":return(0,r.jsx)(x,{setOtpRes:s,otpRes:n,setForm:t});case"reset-password":return(0,r.jsx)(f,{otpRes:n})}}},3916:function(e,t,n){"use strict";n.d(t,{Z:function(){return a},v:function(){return r}});let r="https://kmovie-api.vercel.app",a="https://ophim1.com/phim/"},4333:function(e,t,n){"use strict";n.d(t,{m3:function(){return l},dA:function(){return d},Mo:function(){return o},k9:function(){return m},Cp:function(){return c},g$:function(){return u},c0:function(){return i}});var r=n(3916),a=n(3107);class s{}async function l(e,t){return await s.Login(e,t)}async function o(e,t){return await s.SignUp(e,t)}async function i(e,t,n){return await s.ResetPassword(e,t,n)}async function c(e,t,n){return await s.changePassword(e,t,n)}async function u(){return await s.RefreshToken()}async function d(e){return await s.SendOTP(e)}async function m(e,t){return await s.VerifyOTP(e,t)}s.Login=async(e,t)=>{let n="".concat(r.v,"/users/login"),s=new AbortController;try{return await (0,a.Z)({url:n,method:"post",data:{email:e,password:t},withCredentials:!0,signal:s.signal})}catch(e){return e.response}},s.SignUp=async(e,t)=>{let n="".concat(r.v,"/users/create"),s=new AbortController;try{return await (0,a.Z)({url:n,method:"post",data:{email:e,password:t},withCredentials:!0,signal:s.signal})}catch(e){return e.response}},s.ResetPassword=async(e,t,n)=>{let s="".concat(r.v,"/users/resetPassword"),l=new AbortController;try{return await (0,a.Z)({url:s,method:"post",data:{email:e,password:t,token:n},withCredentials:!0,signal:l.signal})}catch(e){return e.response}},s.changePassword=async(e,t,n)=>{let s="".concat(r.v,"/users/changePassword"),l={userId:e._id,email:e.email,oldPassword:t,newPassword:n},o=new AbortController;try{return await (0,a.Z)({url:s,method:"put",headers:{Authorization:"Bearer ".concat(e.accessToken)},data:l,withCredentials:!0,signal:o.signal})}catch(e){return e.response}},s.RefreshToken=async()=>{let e="".concat(r.v,"/users/refreshToken"),t=new AbortController;try{return(await (0,a.Z)({url:e,method:"post",withCredentials:!0,signal:t.signal})).data}catch(e){console.log(e)}},s.SendOTP=async e=>{let t="".concat(r.v,"/otp/sendOTP"),n=new AbortController;try{return await (0,a.Z)({url:t,method:"get",params:{email:e},withCredentials:!0,signal:n.signal})}catch(e){return e.response}},s.VerifyOTP=async(e,t)=>{let n="".concat(r.v,"/otp/verifyOTP"),s=new AbortController;try{return await (0,a.Z)({url:n,method:"get",params:{email:e,otp:t},withCredentials:!0,signal:s.signal})}catch(e){return e.response}}},3503:function(e,t,n){"use strict";n.d(t,{B2:function(){return a},jF:function(){return r},mr:function(){return s}});let r=(e,t)=>["Full","Trailer"].includes(e||"")?e:["Ho\xe0n Tất","Ho\xe0n tất","ho\xe0n tất"].some(t=>t===(null==e?void 0:e.slice(0,8)))?e.replaceAll("Ho\xe0n Tất","").replaceAll("Ho\xe0n tất","").replaceAll("ho\xe0n tất","").replaceAll("(","").replaceAll(")",""):(e+"/"+t).replaceAll("Tập","").replaceAll("tập","").replaceAll("t\xe2p","").replaceAll("Đang cập nhật","??"),a=(e,t,n)=>{let r=new URLSearchParams(e);return r.set(t,n),r.toString()},s=e=>{let t=Math.floor(e%6e4/1e3);return"".concat(Math.floor(e/6e4),":").concat(t<10?"0".concat(t):t)}}},function(e){e.O(0,[576,129,9,107,337,122,971,69,744],function(){return e(e.s=639)}),_N_E=e.O()}]);